{"data":{"site":{"siteMetadata":{"title":"Bruno Luiz Blog","author":"Bruno Luiz Silva"}},"markdownRemark":{"id":"d9b7a106-e314-56c8-b214-d15472a10f66","excerpt":"Today, Kubernetes is the de facto container orchestration solution. Together with the devops culture, developers have to get familiarised to its tools, such as…","html":"<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/43bd152799fa31b547980eacc66082ea/e98fc/header.jpeg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 720px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 56.46173149309912%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAEDBP/EABYBAQEBAAAAAAAAAAAAAAAAAAMAAv/aAAwDAQACEAMQAAABwODQaCLH/8QAGhAAAgIDAAAAAAAAAAAAAAAAAQIAEBESIf/aAAgBAQABBQIdXRYwwYDX/8QAFREBAQAAAAAAAAAAAAAAAAAAABH/2gAIAQMBAT8Bqv/EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8BP//EABsQAAIBBQAAAAAAAAAAAAAAAAABIQIRIDKB/9oACAEBAAY/AprS4bkO+H//xAAbEAACAgMBAAAAAAAAAAAAAAAAARFBECFRkf/aAAgBAQABPyGCNpRVa+CYEp0oZj//2gAMAwEAAgADAAAAELD/AP/EABgRAAIDAAAAAAAAAAAAAAAAAAARATFh/9oACAEDAQE/EFVE4P/EABgRAAIDAAAAAAAAAAAAAAAAAAABESFh/9oACAECAQE/EGrI0//EABoQAQADAQEBAAAAAAAAAAAAAAEAESExcUH/2gAIAQEAAT8Qq+1Giw9i3T65g0uBIPf2WOy11n//2Q=='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"Photo by Cameron Venti on Unsplash\"\n        title=\"\"\n        src=\"/static/43bd152799fa31b547980eacc66082ea/cfe7c/header.jpeg\"\n        srcset=\"/static/43bd152799fa31b547980eacc66082ea/f39eb/header.jpeg 180w,\n/static/43bd152799fa31b547980eacc66082ea/e1b9c/header.jpeg 360w,\n/static/43bd152799fa31b547980eacc66082ea/cfe7c/header.jpeg 720w,\n/static/43bd152799fa31b547980eacc66082ea/deb56/header.jpeg 1080w,\n/static/43bd152799fa31b547980eacc66082ea/cf22f/header.jpeg 1440w,\n/static/43bd152799fa31b547980eacc66082ea/54366/header.jpeg 2160w,\n/static/43bd152799fa31b547980eacc66082ea/e98fc/header.jpeg 3985w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>Today, Kubernetes is the de facto container orchestration solution. Together with the devops culture, developers have to get familiarised to its tools, such as kubectl.</p>\n<p>After some point though, using kubectl for everything can get quite verbose, specially if you use many namespaces and contexts. The following tips try to minimise the pain of doing operations solely through it, sometimes even using other tools besides it.</p>\n<h2>kubectx: context and namespaces management</h2>\n<p>The operations done in kubectl usually require two params: context and namespace. Any operation will result in something as <code>kubectl --context dev --namespace hello-world exec -it hello-world-app-0 sh</code>. For a one time operation, probably it is fine, but after some point it can get cumbersome. One way to avoid these long command strings is by using <a href=\"https://github.com/ahmetb/kubectx\"> <code>kubectx</code> </a>.</p>\n<p>After installing it, the context can be set simply using <code>kubectx dev</code> and the namespace as <code>kubens hello-world</code>. To list the available contexts and namespaces, just run it without arguments. This will make the above operation to be as <code>kubectl exec -it hello-world-app-0 sh</code>.</p>\n<h2>Terminal aliases</h2>\n<p>Seasoned unix developers are quite used to terminal aliases. Some are quite popular that are even grouped in packs, such as <a href=\"https://github.com/robbyrussell/oh-my-zsh/blob/master/plugins/git/git.plugin.zsh\">oh-my-zsh git aliases</a>. With Kubernetes is not that different.</p>\n<p>Usually, having <code>alias k=\"kubectl \"</code> already make operations shorter. Using the same example, it would give us <code>k exec -it hello-world-app-0 sh</code>. But, most likely, one alias will not be enough. There are some options for this.</p>\n<p>The first one can be set-up in any terminal emulator (zsh, bash…). Get the <code>.kubectl_aliases</code> file from <a href=\"https://github.com/ahmetb/kubectl-aliases\"><code>ahmetb/kubectl-aliases</code></a> and place it in your home directory. After sourcing it on <code>.zshrc</code> or <code>.bashrc</code>, 600 aliases will be available out-of-box.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\"><span class=\"token comment\"># insert it in your .zshrc or .bashrc file</span>\n<span class=\"token punctuation\">[</span> -f ~/.kubectl_aliases <span class=\"token punctuation\">]</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">source</span> ~/.kubectl_aliases</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n<p>If <a href=\"http://zsh.sourceforge.net/\"><code>zsh</code></a> and <a href=\"https://ohmyz.sh/\"><code>oh-my-zsh</code></a> are already set-up, an easier option would be using the pre-installed <code>kubectl</code> plugin. To enable it, edit your <code>.zshrc</code> and add it to the <code>plugins</code> variable (<a href=\"https://github.com/robbyrussell/oh-my-zsh#plugins\">more details about oh-my-zsh plugins here</a>).</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\"><span class=\"token comment\"># .zshrc configs...</span>\nplugins<span class=\"token operator\">=</span><span class=\"token punctuation\">(</span>git kubectl <span class=\"token punctuation\">..</span>.<span class=\"token punctuation\">)</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n<p>There are fewer aliases compared to <code>ahmetb/kubectl-aliases</code>, making it easier to learn and faster to load. The list of <code>oh-my-zsh/kubectl</code> aliases is <a href=\"https://github.com/robbyrussell/oh-my-zsh/tree/master/plugins/kubectl\"> available here </a></p>\n<p><code>kubectx</code> and <code>kubens</code> do not have aliases by default. To allow shorter calls for it, place the following on <code>.zshrc</code> or <code>.bashrc</code>.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\"><span class=\"token comment\"># .zshrc/.bashrc configs...</span>\n<span class=\"token function\">alias</span> kns<span class=\"token operator\">=</span><span class=\"token string\">\"kubens\"</span>\n<span class=\"token function\">alias</span> kcx<span class=\"token operator\">=</span><span class=\"token string\">\"kubectx\"</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span></span></pre></div>\n<p>After all these aliases been set-up, the <code>hello-world-app-0 sh</code> can be accessed using a simple <code>keti hello-world-app-0 sh</code>. As games, it will be as learning combar combos, although it will not be as close as a Hadouken combo.</p>\n<h2>Easy namespace and context indicator in the terminal</h2>\n<p>Developers are humans (in case you didn’t know) and humans do not have bulletproof memory. One can forget that kubernetes context is set to production and then run <code>kubectl apply</code> against production (instead of dev).</p>\n<p>To avoid this, an indicator can be used in the terminal to show what is the actual context and namespace. The easiest way to do it is by using <a href=\"https://github.com/jonmosco/kube-ps1\"><code>kube-ps1</code></a>. It already comes with <code>oh-my-zsh</code>, requiring it to only be enabled on <code>.zshrc</code>.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\"><span class=\"token comment\"># .zshrc configs...</span>\nplugins<span class=\"token operator\">=</span><span class=\"token punctuation\">(</span>git kubectl kube-ps1 <span class=\"token punctuation\">..</span>.<span class=\"token punctuation\">)</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n<p>After installing or enabling, the <code>$PS1</code> needs to be changed to include the <code>kube-ps1</code>. On the <code>.bashrc/.zshrc</code>, include the following:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\"><span class=\"token comment\"># .bashrc/.zshrc configs...</span>\n<span class=\"token function\">export</span> PS1<span class=\"token operator\">=</span><span class=\"token string\">'<span class=\"token variable\"><span class=\"token variable\">$(</span>kube_ps1<span class=\"token variable\">)</span></span> '</span><span class=\"token variable\">$PS1</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n<p>The final result, after setting up the <code>kube-ps1</code>, will be like this</p>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/fec8d741f2ba7c6524e55de6cfa022f6/9eac0/kube-ps1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 720px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 40.55118110236221%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABYlAAAWJQFJUiTwAAABSklEQVQoz53RPU/CQBjA8WqiLESB6Yhge/S9hcQQK6Et5VqKNUYniANIIjDxKYxfQDd3wQ9IchsJnM8hoIsDXvJLe22ef3qpIMB6953006SarxAXuZaDHLuOfMdDk9EEDftDNOqP0PhxjAYPA9Tr9FDnvosiv4XaQRvFjRhdkySfkCQtbFcnCl67dz5red48ikMaRR69vUloRAIah4S2wiYgNGwGlAQNGvgurdcc6tau+HXu1WvssnrxtguKijizDJWZGl4ZlswsW2blisZkpcgUVQTnGyJTtW+aLq3B/cowS0zCZ5+7IMaFDxMimo4XYLmmSUvDKC31P+GthWUpDJeK058gbCxbYfwlWO0JgjIEC9PfXzjjD/kRdB3vhc+YMCtBY9s7yGROklwu85LNnj7/B5/lDd4S7LLKo4fgCKTA8Z5Sm9lD+DnCFz+koApRzSnUAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"Photo by Cameron Venti on Unsplash\"\n        title=\"\"\n        src=\"/static/fec8d741f2ba7c6524e55de6cfa022f6/5b758/kube-ps1.png\"\n        srcset=\"/static/fec8d741f2ba7c6524e55de6cfa022f6/e6885/kube-ps1.png 180w,\n/static/fec8d741f2ba7c6524e55de6cfa022f6/e17e9/kube-ps1.png 360w,\n/static/fec8d741f2ba7c6524e55de6cfa022f6/5b758/kube-ps1.png 720w,\n/static/fec8d741f2ba7c6524e55de6cfa022f6/a00f5/kube-ps1.png 1080w,\n/static/fec8d741f2ba7c6524e55de6cfa022f6/74039/kube-ps1.png 1440w,\n/static/fec8d741f2ba7c6524e55de6cfa022f6/9eac0/kube-ps1.png 1524w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<h2>Investigating logs: the sane way</h2>\n<h2>Automatic deployments (advanced)</h2>\n<h2>Conclusion</h2>\n<h2>References</h2>\n<ul>\n<li>Header image: Photo by <a href=\"https://unsplash.com/photos/QtETdXXR7gs?utm_source=unsplash&#x26;utm_medium=referral&#x26;utm_content=creditCopyText\">Cameron Venti</a> on Unsplash</li>\n</ul>","frontmatter":{"title":"Devops productivity tips for Kubernetes","date":"March 18, 2019","cover":{"childImageSharp":{"fixed":{"width":1200,"height":678,"src":"/static/43bd152799fa31b547980eacc66082ea/935ac/header.jpeg","srcSet":"/static/43bd152799fa31b547980eacc66082ea/935ac/header.jpeg 1x,\n/static/43bd152799fa31b547980eacc66082ea/77668/header.jpeg 1.5x,\n/static/43bd152799fa31b547980eacc66082ea/5347b/header.jpeg 2x,\n/static/43bd152799fa31b547980eacc66082ea/6da74/header.jpeg 3x"}}}}}},"pageContext":{"slug":"/2019/mar/kubernetes-productivity/","previous":{"fields":{"slug":"/2019/feb/a-guide-to-npm-package-publishing/"},"frontmatter":{"title":"A guide on npm package publishing"}},"next":null}}